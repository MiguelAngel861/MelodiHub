# Repify CS50

#### Video demo: https://youtu.be/dKTLScdHv3g

#### Description:
Este código implementa una aplicación web basada en **Flask** que permite a los usuarios interactuar con la API de **Spotify** de una manera integral y fácil de usar, para realizar varias operaciones relacionadas con su cuenta de Spotify. La aplicación hace uso del flujo de autorización **OAuth 2.0**, lo que permite a los usuarios otorgar permisos específicos a la aplicación, como leer su historial de reproducción, acceder a las canciones que han guardado en su biblioteca, ver su perfil y controlar la reproducción de música, todo mientras mantienen la privacidad de sus credenciales de acceso. El funcionamiento básico del sistema comienza en la ruta principal `/`, que sirve como página de inicio y presenta un enlace o botón para que los usuarios se autentiquen utilizando sus credenciales de Spotify. Al hacer clic en este botón, el usuario es redirigido a la ruta `/login`, donde se construye una URL de autorización que contiene la información necesaria para que Spotify sepa qué aplicación está solicitando el acceso, qué tipo de acceso se solicita (a través de la variable `SCOPE` que define los permisos como acceso a la cuenta, historial, biblioteca, y la capacidad de controlar la música), y la URL de redirección (`REDIRECT_URI`) donde Spotify enviará la respuesta con el código de autorización una vez el usuario autorice o deniegue el acceso. Esta URL de autorización se genera dinámicamente en el código a través del cliente de la API de Spotify. Luego, si el usuario autoriza la aplicación, Spotify redirige al usuario a la URL especificada en `REDIRECT_URI` junto con un código de autorización. Este código es capturado por la ruta `/callback` del servidor, que se encarga de intercambiar el código por un **token de acceso** a través de una solicitud POST a la API de Spotify, enviando el código recibido, junto con las credenciales de la aplicación (el `CLIENT_ID` y `CLIENT_SECRET`). Si la solicitud es exitosa, Spotify devuelve un token de acceso, que es guardado en la sesión del usuario para ser utilizado en futuras solicitudes a la API, permitiendo a la aplicación actuar en nombre del usuario y obtener datos como su perfil, historial de canciones, etc. Posteriormente, el flujo sigue con la ruta `/profile`, donde el token de acceso se usa para realizar una solicitud GET al endpoint `/me` de la API de Spotify para obtener información detallada sobre el usuario, como su nombre, correo electrónico y detalles de su cuenta. Esta información se pasa a una plantilla de **Flask**, `perfilUsuario.html`, para ser visualizada por el usuario en el navegador. Además, las rutas `/historial` y `/gustados` permiten acceder a las canciones que el usuario ha escuchado recientemente y a las canciones que ha guardado en su biblioteca. Ambas rutas hacen solicitudes GET a la API de Spotify utilizando el token de acceso para obtener hasta 50 canciones de cada tipo. La ruta `/historial` obtiene las canciones reproducidas recientemente mediante el endpoint `/me/player/recently-played` de la API de Spotify. La respuesta de la API contiene los detalles de cada canción, como su nombre, los artistas y la fecha en que se reprodujo, y esta información se presenta al usuario en la plantilla `historial.html`. De manera similar, la ruta `/gustados` obtiene las canciones que el usuario ha guardado en su biblioteca mediante el endpoint `/me/tracks`, y presenta estos datos, tales como el nombre de la canción, el artista, el álbum y la fecha en que se guardó la canción, en la plantilla `canciones.html`. Ambas rutas permiten a los usuarios visualizar sus canciones preferidas y las que han escuchado recientemente, haciendo uso de la API de Spotify y de las plantillas de **Flask** para organizar y mostrar la información de manera comprensible y clara. La ruta `/repifyWawa` ofrece una funcionalidad adicional interesante al permitir que el usuario vea las canciones que aparecen tanto en su historial de reproducción como en su lista de canciones guardadas, encontrando las canciones comunes entre ambas listas. Para hacerlo, la ruta realiza dos solicitudes simultáneas a la API de Spotify, una para obtener las canciones escuchadas recientemente y otra para obtener las canciones guardadas. A continuación, se comparan los ID de las canciones de ambas listas y se encuentra la intersección de estos ID utilizando el operador `&` de conjuntos de Python. Finalmente, las canciones que aparecen en ambas listas se muestran en la plantilla `repify.html`. Esta funcionalidad es particularmente útil para aquellos usuarios que deseen descubrir las canciones que más les gustan y que han escuchado con frecuencia. Además de estas funcionalidades de consulta y visualización, la aplicación también ofrece la posibilidad de **controlar la reproducción de música** a través de la ruta `/play`. Aunque no se proporciona la implementación completa en el código, esta ruta debería permitir a los usuarios reproducir canciones directamente desde la aplicación, utilizando la API de Spotify para enviar solicitudes PUT al endpoint `me/player/play` de Spotify, pasando la URI de la canción que el usuario desea escuchar. Este tipo de funcionalidad es importante, ya que permite que el usuario controle la reproducción de su música desde la propia aplicación web, haciendo de esta herramienta una plataforma de gestión de Spotify más completa. Además, el código también incluye la ruta `/inicio`, que actúa como la página de inicio, sirviendo como un centro de navegación para que los usuarios puedan acceder a las diferentes secciones de la aplicación, como el perfil, el historial de reproducción, las canciones guardadas, las canciones comunes y la funcionalidad de control de música. En cuanto a la interfaz de usuario, el **navbar** de **Bootstrap** se utiliza de manera consistente a lo largo de toda la aplicación para permitir una navegación fluida entre las diferentes secciones. Este **navbar** contiene enlaces para cada una de las rutas clave, como el perfil, el historial, las canciones guardadas, el inicio y otras funcionalidades importantes. Además, el **navbar** está diseñado para ser completamente **responsivo**, lo que significa que se adapta a diferentes tamaños de pantalla, garantizando una experiencia de usuario óptima tanto en dispositivos de escritorio como en dispositivos móviles. La integración de **Bootstrap** facilita la creación de una interfaz atractiva y moderna, mejorando la experiencia del usuario sin la necesidad de escribir grandes cantidades de CSS o JavaScript personalizados. En cuanto a la seguridad y la gestión de sesiones, el código utiliza la clave secreta `app.secret_key` para garantizar que las sesiones de usuario sean seguras, protegiendo los datos almacenados en la sesión, como el **token de acceso**. Sin esta clave secreta, Flask no podría gestionar las sesiones correctamente, lo que haría que el acceso a las rutas protegidas (como el perfil o el historial de reproducción) no fuera seguro. De esta manera, la clave secreta es esencial para la operación de la aplicación. Por último, aunque el código es funcional y cumple con su propósito, es importante destacar que hay oportunidades para mejorar la aplicación. Por ejemplo, se podría agregar un manejo de errores más robusto para las solicitudes a la API de Spotify, asegurando que el usuario reciba mensajes de error claros en caso de que haya problemas con la autenticación o con la obtención de datos. Además, sería beneficioso implementar pruebas automatizadas para asegurar que cada parte del sistema funcione correctamente y que los cambios en el código no introduzcan nuevos errores. También se podría mejorar la eficiencia de las solicitudes a la API, por ejemplo, implementando un sistema de caché para almacenar temporalmente los resultados de las solicitudes más frecuentes. En resumen, este código ofrece una base sólida para una aplicación web que interactúa con Spotify y permite a los usuarios explorar y gestionar su música y perfil de manera intuitiva y visual. Gracias a la integración de **Flask**, **Bootstrap** y la **API de Spotify**, se crea una experiencia de usuario interactiva y atractiva que puede ser expandida con características adicionales, como recomendaciones personalizadas o análisis avanzados del historial de escucha. El uso del **navbar** en todas las rutas proporciona una navegación eficiente y coherente en toda la aplicación, mejorando aún más la experiencia del usuario.