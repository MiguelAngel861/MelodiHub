# Repify CS50

#### Video demo: https://youtu.be/dKTLScdHv3g

#### Description:
Este código implementa una aplicación web desarrollada en **Flask** que interactúa con la API de Spotify para permitir a los usuarios autenticarse y acceder a varias funciones relacionadas con su cuenta de Spotify, como consultar su perfil, ver su historial de canciones reproducidas, listar sus canciones guardadas, identificar canciones comunes entre el historial y las guardadas, y controlar la reproducción de música directamente desde la aplicación. A continuación, se explica en detalle cada componente y funcionalidad del código. Primero, se inicializa la aplicación Flask y se define una clave secreta (`app.secret_key`) que es esencial para manejar sesiones de usuario de manera segura. A continuación, se configuran las credenciales de la aplicación en Spotify: `CLIENT_ID`, `CLIENT_SECRET` y `REDIRECT_URI`. Estas credenciales permiten a la aplicación autenticar a los usuarios y obtener acceso a sus datos. También se especifican las rutas y permisos necesarios mediante la variable `SCOPE`, que incluye una lista de alcances como leer información del perfil, historial de reproducción, canciones guardadas y controlar la reproducción.  La ruta principal (`/`) renderiza una plantilla de inicio de sesión (`login.html`), que contiene un botón para iniciar sesión con Spotify. Al hacer clic en este botón, el usuario es redirigido a la ruta `/login`, que construye una URL para la página de autorización de Spotify (`AUTHN_URL`). La URL incluye el `CLIENT_ID`, el tipo de respuesta (`code`), la URL de redirección (`REDIRECT_URI`) y los permisos solicitados (`SCOPE`). Al acceder a esta URL, Spotify muestra al usuario una página donde puede aceptar o rechazar los permisos solicitados por la aplicación. Cuando el usuario autoriza la aplicación, Spotify redirige al usuario a la URL definida en `REDIRECT_URI` con un código de autorización como parámetro en la solicitud. Este código es manejado en la ruta `/callback`, donde se realiza una solicitud POST al endpoint `TOKEN_URL` de Spotify para intercambiar el código de autorización por un token de acceso. El token de acceso permite realizar solicitudes a la API de Spotify en nombre del usuario. Una vez obtenido, este token se almacena en la sesión del usuario para su uso posterior. La funcionalidad de perfil se maneja en la ruta `/profile`, donde se utiliza el token de acceso almacenado para realizar una solicitud GET al endpoint `me` de la API de Spotify. Esto devuelve información sobre el usuario autenticado, como su nombre, correo electrónico y detalles de la cuenta. Los datos obtenidos se renderizan en la plantilla `perfilUsuario.html`, proporcionando al usuario una vista personalizada de su perfil. El historial de reproducción se accede mediante la ruta `/historial`, que solicita las últimas 50 canciones reproducidas utilizando el endpoint `me/player/recently-played`. La solicitud incluye encabezados de autorización con el token del usuario y parámetros que especifican el número máximo de elementos a obtener. La respuesta de la API se procesa para extraer información clave, como el nombre de la canción, los artistas asociados y la fecha de reproducción. Estos datos se organizan en una lista de diccionarios y se pasan a la plantilla `historial.html`, donde se muestran de forma estructurada. La funcionalidad para listar canciones guardadas se encuentra en la ruta `/gustados`, que realiza una solicitud GET al endpoint `me/tracks` de la API de Spotify. Similar al historial, se solicita un máximo de 50 canciones con encabezados de autorización y parámetros. La respuesta incluye detalles como el nombre de la canción, los artistas, el álbum y la fecha en que la canción fue guardada. Estos datos se procesan y se renderizan en la plantilla `canciones.html`. Una característica interesante de la aplicación es la ruta `/repifyWawa`, que combina las canciones del historial de reproducción y las canciones guardadas para identificar coincidencias. En esta ruta, se realizan dos solicitudes GET: una al historial y otra a las canciones guardadas. Los datos obtenidos se almacenan en diccionarios utilizando el ID único de cada canción como clave. Luego, se encuentra la intersección de las claves en ambos diccionarios para determinar las canciones comunes entre las dos listas. Las canciones coincidentes se organizan en una lista y se renderizan en la plantilla `repify.html`. Además de la funcionalidad de consulta, la aplicación también permite controlar la reproducción de música mediante la ruta `/play`. Esta ruta utiliza un método POST para recibir datos JSON desde el frontend, que incluye la URI de la canción que se desea reproducir. La URI es enviada a Spotify mediante una solicitud PUT al endpoint `me/player/play` junto con los encabezados de autorización y el cuerpo de la solicitud en formato JSON. Si la solicitud se realiza correctamente, la API responde con un código de estado 204, indicando que la canción ha comenzado a reproducirse. Si ocurre un error, la aplicación responde con un mensaje JSON que describe el problema. La aplicación también incluye una ruta `/inicio`, que simplemente renderiza la plantilla `index.html`, sirviendo como página principal para la navegación entre las diferentes funcionalidades. Finalmente, existe una ruta `/logout` que permite al usuario cerrar sesión. Aunque el manejo del cierre de sesión no está completamente implementado, la ruta intenta borrar el token de acceso de la sesión y redirigir al usuario a la página principal. Este código combina la potencia de Flask y la API de Spotify para crear una aplicación web interactiva y personalizada. Permite a los usuarios explorar y gestionar sus datos de Spotify de manera visual e intuitiva. La integración con OAuth 2.0 asegura que el acceso a los datos sea seguro y autorizado por el usuario. Además, el uso de plantillas HTML facilita la presentación de la información y mejora la experiencia del usuario. Aunque el código está funcional, podría beneficiarse de mejoras como la implementación de manejo de errores más robusto, la adición de pruebas automatizadas y la optimización de la gestión de sesiones. En su estado actual, representa una base sólida para una aplicación que puede ser ampliada con características adicionales, como recomendaciones musicales o análisis del historial de escucha.
